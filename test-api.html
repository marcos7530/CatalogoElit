<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API ELIT</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 20px; margin: 10px 0; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>Test de API ELIT</h1>
    
    <div>
        <h3>Credenciales:</h3>
        <p><strong>User ID:</strong> 30440</p>
        <p><strong>Token:</strong> geuai36y0u4</p>
    </div>
    
    <button onclick="testAPI()">Probar API (Formato Documentación)</button>
    <button onclick="testWithDifferentLimit()">Probar con límite 10</button>
    <button onclick="testExactDocumentation()">Test Exacto de Documentación</button>
    
    <div id="result"></div>
    
    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="result">Probando API...</div>';
            
            try {
                // Usando exactamente el formato de la documentación oficial
                var myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");
                
                var raw = JSON.stringify({
                    "user_id": 30440,
                    "token": "geuai36y0u4"
                });
                
                var requestOptions = {
                    method: 'POST',
                    headers: myHeaders,
                    body: raw,
                    redirect: 'follow'
                };
                
                console.log('URL:', 'https://clientes.elit.com.ar/v1/api/productos?limit=100');
                console.log('Headers:', myHeaders);
                console.log('Body:', raw);
                console.log('Request Options:', requestOptions);
                
                const response = await fetch("https://clientes.elit.com.ar/v1/api/productos?limit=100", requestOptions);
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                // Probar primero con .text() como en la documentación
                const textData = await response.text();
                console.log('Response as text:', textData);
                
                // Luego intentar parsear como JSON
                let data;
                try {
                    data = JSON.parse(textData);
                    console.log('Response as JSON:', data);
                } catch (parseError) {
                    console.error('Error parsing JSON:', parseError);
                    data = textData;
                }
                
                let products = [];
                if (Array.isArray(data)) {
                    products = data;
                } else if (data.resultado && Array.isArray(data.resultado)) {
                    // Estructura correcta de la API ELIT
                    products = data.resultado;
                } else if (data.productos && Array.isArray(data.productos)) {
                    products = data.productos;
                } else if (data.data && Array.isArray(data.data)) {
                    products = data.data;
                }
                
                resultDiv.innerHTML = `
                    <div class="result success">
                        <h3>✅ API Funcionando</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Productos encontrados:</strong> ${products.length}</p>
                        <p><strong>Tipo de respuesta:</strong> ${Array.isArray(data) ? 'Array' : 'Object'}</p>
                        ${products.length > 0 ? `
                            <h4>Primer producto:</h4>
                            <pre>${JSON.stringify(products[0], null, 2)}</pre>
                        ` : ''}
                    </div>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ Error en API</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Stack:</strong> ${error.stack}</p>
                    </div>
                `;
            }
        }
        
        async function testWithDifferentLimit() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="result">Probando API con límite 10...</div>';
            
            try {
                const url = 'https://clientes.elit.com.ar/v1/api/productos?limit=10';
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: '30440',
                        token: 'geuai36y0u4'
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Response data (limit 10):', data);
                
                let products = [];
                if (Array.isArray(data)) {
                    products = data;
                } else if (data.resultado && Array.isArray(data.resultado)) {
                    // Estructura correcta de la API ELIT
                    products = data.resultado;
                } else if (data.productos && Array.isArray(data.productos)) {
                    products = data.productos;
                } else if (data.data && Array.isArray(data.data)) {
                    products = data.data;
                }
                
                resultDiv.innerHTML = `
                    <div class="result success">
                        <h3>✅ API con límite 10</h3>
                        <p><strong>Productos encontrados:</strong> ${products.length}</p>
                        <p><strong>Respuesta completa:</strong></p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ Error en API</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Test exacto de la documentación
        function testExactDocumentation() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="result">Ejecutando test exacto de documentación...</div>';
            
            // Código exacto de la documentación
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            
            var raw = JSON.stringify({
                "user_id": 30440,
                "token": "geuai36y0u4"
            });
            
            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            
            fetch("https://clientes.elit.com.ar/v1/api/productos?limit=100", requestOptions)
                .then(response => response.text())
                .then(result => {
                    console.log('Resultado exacto de documentación:', result);
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>✅ Test Exacto de Documentación</h3>
                            <p><strong>Resultado:</strong></p>
                            <pre>${result}</pre>
                        </div>
                    `;
                })
                .catch(error => {
                    console.log('error', error);
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>❌ Error en Test Exacto</h3>
                            <p><strong>Error:</strong> ${error.message}</p>
                        </div>
                    `;
                });
        }
        
        // Auto-test al cargar
        window.addEventListener('load', () => {
            console.log('Página cargada, iniciando test automático...');
            setTimeout(testAPI, 1000);
        });
    </script>
</body>
</html>
